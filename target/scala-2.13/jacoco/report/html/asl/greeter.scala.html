<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>greeter.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">asl</a> &gt; <span class="el_source">greeter.scala</span></div><h1>greeter.scala</h1><pre class="source lang-java linenums">
            package asl

            import _root_.scala.collection.mutable.HashMap

 import _root_.akka.actor.typed.{ActorRef, Behavior, SupervisorStrategy}
 import _root_.akka.actor.typed.scaladsl.{ActorContext, Behaviors, Routers}

 import _root_.scala.util.Failure
 import _root_.scala.util.Success
 import _root_.akka.util.Timeout
 import _root_.scala.concurrent.duration._
 import _root_.akka.actor.typed.scaladsl.AskPattern._
 import _root_.scala.language.implicitConversions
 import _root_.scala.concurrent.{Await, Future}
 import _root_.scala.jdk.CollectionConverters._
 import std.coms._
 import std.converters._

 import scala.util.Random
 import bb._
 import infrastructure._
 import bb.expstyla.exp._

<span class="nc" id="L25"> object greeter {</span>

<span class="fc" id="L27"> object Intention {</span>

<span class="fc" id="L29">       def apply(p_executionContext: ExecutionContext): Behavior[ISubGoalMessage] = Behaviors.setup { context =&gt;</span>

         Behaviors.receive {
         (context, message) =&gt;

          implicit val executionContext = p_executionContext.copy(intention = context, src = message.source)

         message match {
            case SubGoalMessage(_,_,r) =&gt;
               message.goal match {

                   case greeter.hello_1 =&gt;
                     greeter.hello_1.execute(message.params.asInstanceOf[Parameters])

                   case greeter.hi_0 =&gt;
                     greeter.hi_0.execute(message.params.asInstanceOf[Parameters])


           case _ =&gt;
             context.log.error(&quot;This actor can not handle goal of type {}&quot;, message.goal)
         }
           r match {
                 case a : AkkaMessageSource =&gt; 
                   a.src ! IntentionDoneMessage(AkkaMessageSource(executionContext.agent.self))
                 case DummyMessageSource(_) =&gt; 
                   context.log.error(&quot;Intention Done!&quot;)
               }

               Behaviors.same
             case InitEndMessage(r) =&gt;
               Behaviors.stopped
       }
      }
     }
     }

<span class="fc" id="L65"> object Agent extends IAgent {</span>

<span class="fc" id="L67">         override def agent_type: String = &quot;greeter&quot;</span>

<span class="pc" id="L69">         var vars = VarMap()</span>

<span class="fc" id="L71">         def initGoals()(implicit executionContext: ExecutionContext) = List[StructTerm](</span>
         )

<span class="fc" id="L74">         def initBeliefs()(implicit executionContext: ExecutionContext) = List[StructTerm](</span>
         )

         def create_goal_message(t: StructTerm, ref: IMessageSource) (implicit executionContext: ExecutionContext): Option[SubGoalMessage] = {
<span class="fc bfc" id="L78" title="All 2 branches covered.">                     if(t.matchOnlyFunctorAndArity(&quot;hello&quot;,1)) {</span>
           //          if(t.functor==&quot;hello&quot; &amp;&amp; t.terms.size == 1 ) {
<span class="fc" id="L80">                       val args: Parameters = Parameters(t.terms.toList)</span>
<span class="fc" id="L81">                       Option(SubGoalMessage(hello_1, args, ref))</span>
<span class="fc bfc" id="L82" title="All 2 branches covered.">                     } else if(t.matchOnlyFunctorAndArity(&quot;hi&quot;,0)) {</span>
           //          if(t.functor==&quot;hi&quot; &amp;&amp; t.terms.size == 0 ) {
<span class="fc" id="L84">                       val args: Parameters = Parameters(t.terms.toList)</span>
<span class="fc" id="L85">                       Option(SubGoalMessage(hi_0, args, ref))</span>
                     } else  {
<span class="fc" id="L87">             Option.empty[SubGoalMessage]</span>
             }
         }

     def apply(name: String, yellowPages: YellowPages, MAS: ActorRef[IMessage]): Behavior[IMessage] = {
<span class="fc" id="L92">       Behaviors.setup { context =&gt;</span>
         val yp: YellowPages = yellowPages
         val bb: BeliefBaseStyla = BeliefBaseFactory()
         val logger = AgentLogger()
         implicit val executionContext: ExecutionContext = ExecutionContext(name, agent_type, context, yp, bb, logger)
         bb.assert(initBeliefs)

         val initiator = context.spawn(Intention(executionContext), &quot;initiator&quot;)

         MAS ! ReadyMessage(context.self)
         Behaviors.receive {
           (context, message) =&gt;
             message match {
               case StartMessage() =&gt;
                 logger.start()

                 implicit val timeout: Timeout = 99999.seconds
                 implicit val ec = context.executionContext
                 implicit val scheduler = context.system.scheduler


                 //              initGoals.foreach( tuple =&gt; initiator ! SubGoalMessage(tuple._1,tuple._2,context.self))
                 initGoals.foreach(struct =&gt; {


                   val result: Future[IMessage] = initiator.ask[IMessage](ref =&gt; {
                     val subGoal = create_goal_message(struct, AkkaMessageSource(ref))
                     if (subGoal.isDefined)
                       subGoal.get
                     else
                       throw new RuntimeException(s&quot;No plan for initial goal $struct&quot;)
                     }
                   )


                   result.onComplete {
                     case Success(IntentionDoneMessage(r)) =&gt; IntentionDoneMessage(r)
                     case Failure(_) =&gt; IntentionErrorMessage(src = null)
                   }

                   Await.result(result, timeout.duration)

                   //                context.ask[ISubGoalMessage, IMessage](initiator, ref =&gt; SubGoalMessage(tuple._1, tuple._2,name, ref)) {
                   //                  case Success(IntentionDoneMessage(_, _)) =&gt; IntentionDoneMessage()
                   //                  case Failure(_) =&gt; IntentionErrorMessage()
                   //                }
                 }
                 )

                 initiator ! InitEndMessage(context.self)
                 normal_behavior()

               //            case InitEndMessage(_) =&gt;
               //              context.log.debug(f&quot;$name: I have started, switching behavior&quot;)
               //              normal_behavior()
             }

         }
       }
     }

     def normal_behavior()(implicit executionContext: ExecutionContext): Behavior[IMessage] = {
<span class="fc" id="L154">       Behaviors.setup { context =&gt;</span>

         val pool = Routers.pool(poolSize = 8)(
           Behaviors.supervise(Intention(executionContext)).onFailure[Exception](SupervisorStrategy.restart))

         val router = context.spawn(pool, &quot;intention-pool&quot;)

         Behaviors.receive {
           (context, message) =&gt;
             message match {
               case IntentionDoneMessage(r) =&gt;
               //context.log.debug(f&quot;${executionContext.name}: an intention was done by $s&quot;)
               case SubGoalMessage(_, _, _) =&gt;
                 router ! message.asInstanceOf[SubGoalMessage]
               case GoalMessage(m, ref) =&gt;
                 m match {
                   case t: StructTerm =&gt;
                     val subGoal = create_goal_message(t, ref)

                     if (subGoal.isDefined)
                       context.self ! subGoal.get
                     else
                       ref.asInstanceOf[AkkaMessageSource].src ! IntentionErrorMessage(NoPlanMessage(),AkkaMessageSource(executionContext.agent.self))


                 }
             }
             Behaviors.same
         }
       }
     }
   }

<span class="fc" id="L187">      object hello_1 extends IGoal {</span>

        def execute(params: Parameters) (implicit executionContext: ExecutionContext) : Unit = {
<span class="fc" id="L190">         var vars = VarMap()</span>
                 //plan 0 start

<span class="fc" id="L193">                         vars.clear()</span>
<span class="fc" id="L194">                         vars +=(   &quot;Name&quot; -&gt; params.l_params(0))</span>

<span class="fc" id="L196">                         val r0 = executionContext.beliefBase.query(StructTerm(&quot;==&quot;,Seq[GenericTerm](asString(vars(&quot;Name&quot;)).contains(StringTerm(&quot;Mr&quot;)),BooleanTerm(true))))</span>

<span class="fc bfc" id="L198" title="All 2 branches covered.">                         if (r0.result) {</span>
<span class="fc" id="L199">                             r0.bindings foreach { case (k, v) =&gt; vars += (k -&gt; v.asInstanceOf[GenericTerm]) }</span>
<span class="fc" id="L200">                             plan0(vars)</span>
<span class="fc" id="L201">                             return</span>
                          }

                          // plan 0 end
                 //plan 1 start

<span class="fc" id="L207">                         vars.clear()</span>
<span class="fc" id="L208">                         vars +=(   &quot;Name&quot; -&gt; params.l_params(0))</span>

<span class="fc" id="L210">                         val r1 = executionContext.beliefBase.query(StructTerm(&quot;;&quot;,Seq[GenericTerm](StructTerm(&quot;==&quot;,Seq[GenericTerm](asString(vars(&quot;Name&quot;)).contains(StringTerm(&quot;Ms&quot;)),BooleanTerm(true))),asString(vars(&quot;Name&quot;)).contains(StringTerm(&quot;Mrs&quot;)))))</span>

<span class="fc bfc" id="L212" title="All 2 branches covered.">                         if (r1.result) {</span>
<span class="fc" id="L213">                             r1.bindings foreach { case (k, v) =&gt; vars += (k -&gt; v.asInstanceOf[GenericTerm]) }</span>
<span class="fc" id="L214">                             plan1(vars)</span>
<span class="fc" id="L215">                             return</span>
                          }

                          // plan 1 end
                 //plan 2 start

<span class="fc" id="L221">                         vars.clear()</span>
<span class="fc" id="L222">                         vars +=( &quot;0&quot; -&gt; params.l_params(0))</span>

<span class="fc" id="L224">                         val m2 = executionContext.beliefBase.matchTerms(StructTerm(&quot;hello&quot;,Seq[GenericTerm](StringTerm(&quot;John&quot;))),StructTerm(&quot;hello&quot;,params.l_params));</span>
<span class="fc bfc" id="L225" title="All 2 branches covered.">                         if(m2.result)</span>
                         {
<span class="fc" id="L227">                          m2.bindings foreach { case (k, v) =&gt; vars += (k -&gt; v.asInstanceOf[GenericTerm]) }</span>

<span class="fc" id="L229">                             plan2(vars)</span>
<span class="fc" id="L230">                             return</span>
                          }
                          // plan 2 end


<span class="fc" id="L235">             executionContext.src.asInstanceOf[AkkaMessageSource].address() ! IntentionErrorMessage(NoApplicablePlanMessage(),AkkaMessageSource(executionContext.agent.self))</span>

        }


                      def plan0(vars: VarMap)(implicit executionContext: ExecutionContext): Unit = {

<span class="fc" id="L242">                                          PrimitiveAction.execute(PrimitiveAction.Parameters(() =&gt; achieve(executionContext.src,StructTerm(&quot;greetings&quot;,Seq[GenericTerm](StringTerm(&quot;Sir&quot;))))))</span>


                     }
                      def plan1(vars: VarMap)(implicit executionContext: ExecutionContext): Unit = {

<span class="fc" id="L248">                                          PrimitiveAction.execute(PrimitiveAction.Parameters(() =&gt; achieve(executionContext.src,StructTerm(&quot;greetings&quot;,Seq[GenericTerm](StringTerm(&quot;Madam&quot;))))))</span>


                     }
                      def plan2(vars: VarMap)(implicit executionContext: ExecutionContext): Unit = {

<span class="fc" id="L254">                                          PrimitiveAction.execute(PrimitiveAction.Parameters(() =&gt; achieve(executionContext.src,StructTerm(&quot;greetings&quot;,Seq[GenericTerm](StringTerm(&quot;John&quot;))))))</span>
<span class="fc" id="L255">                                          hi_0.execute(Parameters(List(  )))</span>


                     }


      }

<span class="fc" id="L263">      object hi_0 extends IGoal {</span>

        def execute(params: Parameters) (implicit executionContext: ExecutionContext) : Unit = {
<span class="fc" id="L266">         var vars = VarMap()</span>
                 //plan 0 start

<span class="fc" id="L269">                         vars.clear()</span>
<span class="fc" id="L270">                             plan0(vars)</span>
<span class="fc" id="L271">                             return</span>
                          // plan 0 end


             executionContext.src.asInstanceOf[AkkaMessageSource].address() ! IntentionErrorMessage(NoApplicablePlanMessage(),AkkaMessageSource(executionContext.agent.self))

        }


                      def plan0(vars: VarMap)(implicit executionContext: ExecutionContext): Unit = {

<span class="fc" id="L282">                                          PrimitiveAction.execute(PrimitiveAction.Parameters(() =&gt; achieve(StringTerm(&quot;mocked&quot;),StructTerm(&quot;greetings&quot;,Seq[GenericTerm]()))))</span>


                     }


      }




 }
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>