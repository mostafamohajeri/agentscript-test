<?xml version="1.0" encoding="utf-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>greeter_simple.scala</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=2;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Jacoco Coverage Report</a> &gt; <a href="index.source.html" class="el_package">asl</a> &gt; <span class="el_source">greeter_simple.scala</span></div><h1>greeter_simple.scala</h1><pre class="source lang-java linenums">
            package asl

            import _root_.scala.collection.mutable.HashMap

 import _root_.akka.actor.typed.{ActorRef, Behavior, SupervisorStrategy}
 import _root_.akka.actor.typed.scaladsl.{ActorContext, Behaviors, Routers}

 import _root_.scala.util.Failure
 import _root_.scala.util.Success
 import _root_.akka.util.Timeout
 import _root_.scala.concurrent.duration._
 import _root_.akka.actor.typed.scaladsl.AskPattern._
 import _root_.scala.language.implicitConversions
 import _root_.scala.concurrent.{Await, Future}
 import _root_.scala.jdk.CollectionConverters._
 import std.coms._
 import std.converters._

 import scala.util.Random
 import bb._
 import infrastructure._
 import bb.expstyla.exp._

<span class="nc" id="L25"> object greeter_simple {</span>

<span class="fc" id="L27"> object Intention {</span>

<span class="fc" id="L29">       def apply(p_executionContext: ExecutionContext): Behavior[ISubGoalMessage] = Behaviors.setup { context =&gt;</span>

         Behaviors.receive {
         (context, message) =&gt;

          implicit val executionContext = p_executionContext.copy(intention = context, src = message.source)

         message match {
            case SubGoalMessage(_,_,r) =&gt;
               message.goal match {

                   case greeter_simple.receive =&gt;
                     greeter_simple.receive.execute(message.params.asInstanceOf[Parameters])


           case _ =&gt;
             context.log.error(&quot;This actor can not handle goal of type {}&quot;, message.goal)
         }
           r match {
                 case a : AkkaMessageSource =&gt; 
                   a.src ! IntentionDoneMessage(AkkaMessageSource(executionContext.agent.self))
                 case DummyMessageSource(_) =&gt; 
                   context.log.error(&quot;Intention Done!&quot;)
               }

               Behaviors.same
             case InitEndMessage(r) =&gt;
               Behaviors.stopped
       }
      }
     }
     }

<span class="fc" id="L62"> object Agent extends IAgent {</span>

<span class="fc" id="L64">         override def agent_type: String = &quot;greeter_simple&quot;</span>

<span class="pc" id="L66">         var vars = VarMap()</span>

<span class="fc" id="L68">         def initGoals()(implicit executionContext: ExecutionContext) = List[StructTerm](</span>
         )

<span class="fc" id="L71">         def initBeliefs()(implicit executionContext: ExecutionContext) = List[StructTerm](</span>
         )

         def create_goal_message(t: StructTerm, ref: IMessageSource) (implicit executionContext: ExecutionContext): Option[SubGoalMessage] = {
<span class="pc bpc" id="L75" title="4 of 8 branches missed.">                     if(t.functor==&quot;receive&quot; &amp;&amp; t.terms.size == 1 ) {</span>
<span class="fc" id="L76">                       val args: Parameters = Parameters(t.terms.toList)</span>
<span class="fc" id="L77">                       Option(SubGoalMessage(receive, args, ref))</span>
                     } else  {
<span class="fc" id="L79">             Option.empty[SubGoalMessage]</span>
             }
         }

     def apply(name: String, yellowPages: ActorRef[IMessage], MAS: ActorRef[IMessage]): Behavior[IMessage] = {
<span class="fc" id="L84">       Behaviors.setup { context =&gt;</span>
         val yp: ActorRef[IMessage] = yellowPages
         val bb: BeliefBaseStyla = BeliefBaseFactory()
         val logger = AgentLogger()
         implicit val executionContext: ExecutionContext = ExecutionContext(name, agent_type, context, yp, bb, logger)
         bb.assert(initBeliefs)

         val initiator = context.spawn(Intention(executionContext), &quot;initiator&quot;)

         MAS ! ReadyMessage(context.self)
         Behaviors.receive {
           (context, message) =&gt;
             message match {
               case StartMessage() =&gt;
                 logger.start()

                 implicit val timeout: Timeout = 99999.seconds
                 implicit val ec = context.executionContext
                 implicit val scheduler = context.system.scheduler


                 //              initGoals.foreach( tuple =&gt; initiator ! SubGoalMessage(tuple._1,tuple._2,context.self))
                 initGoals.foreach(struct =&gt; {


                   val result: Future[IMessage] = initiator.ask[IMessage](ref =&gt; {
                     val subGoal = create_goal_message(struct, AkkaMessageSource(ref))
                     if (subGoal.isDefined)
                       subGoal.get
                     else
                       throw new RuntimeException(s&quot;No plan for initial goal $struct&quot;)
                     }
                   )


                   result.onComplete {
                     case Success(IntentionDoneMessage(r)) =&gt; IntentionDoneMessage(r)
                     case Failure(_) =&gt; IntentionErrorMessage(src = null)
                   }

                   Await.result(result, timeout.duration)

                   //                context.ask[ISubGoalMessage, IMessage](initiator, ref =&gt; SubGoalMessage(tuple._1, tuple._2,name, ref)) {
                   //                  case Success(IntentionDoneMessage(_, _)) =&gt; IntentionDoneMessage()
                   //                  case Failure(_) =&gt; IntentionErrorMessage()
                   //                }
                 }
                 )

                 initiator ! InitEndMessage(context.self)
                 normal_behavior()

               //            case InitEndMessage(_) =&gt;
               //              context.log.debug(f&quot;$name: I have started, switching behavior&quot;)
               //              normal_behavior()
             }

         }
       }
     }

     def normal_behavior()(implicit executionContext: ExecutionContext): Behavior[IMessage] = {
<span class="fc" id="L146">       Behaviors.setup { context =&gt;</span>

         val pool = Routers.pool(poolSize = 8)(
           Behaviors.supervise(Intention(executionContext)).onFailure[Exception](SupervisorStrategy.restart))

         val router = context.spawn(pool, &quot;intention-pool&quot;)

         Behaviors.receive {
           (context, message) =&gt;
             message match {
               case IntentionDoneMessage(r) =&gt;
               //context.log.debug(f&quot;${executionContext.name}: an intention was done by $s&quot;)
               case SubGoalMessage(_, _, _) =&gt;
                 router ! message.asInstanceOf[SubGoalMessage]
               case GoalMessage(m, ref) =&gt;
                 m match {
                   case t: StructTerm =&gt;
                     val subGoal = create_goal_message(t, ref)

                     if (subGoal.isDefined)
                       context.self ! subGoal.get
                     else
                       ref.asInstanceOf[AkkaMessageSource].src ! IntentionErrorMessage(NoPlanMessage(),AkkaMessageSource(executionContext.agent.self))


                 }
             }
             Behaviors.same
         }
       }
     }
   }

<span class="fc" id="L179">      object receive extends IGoal {</span>

        def execute(params: Parameters) (implicit executionContext: ExecutionContext) : Unit = {
<span class="fc" id="L182">         var vars = VarMap()</span>
                 //plan 0 start

<span class="fc" id="L185">                         vars.clear()</span>
<span class="fc" id="L186">                         vars +=(   &quot;M&quot; -&gt; params.l_params(0))</span>


<span class="fc" id="L189">                         val r0 = executionContext.beliefBase.query(StructTerm(&quot;;&quot;,Seq[GenericTerm](StructTerm(&quot;==&quot;,Seq[GenericTerm](vars(&quot;M&quot;),StringTerm(&quot;Hi&quot;))),StructTerm(&quot;==&quot;,Seq[GenericTerm](vars(&quot;M&quot;),StringTerm(&quot;Hello&quot;))))))</span>

<span class="fc bfc" id="L191" title="All 2 branches covered.">                         if (r0.result) {</span>
<span class="fc" id="L192">                             r0.bindings foreach { case (k, v) =&gt; vars += (k -&gt; v.asInstanceOf[GenericTerm]) }</span>
<span class="fc" id="L193">                             plan0(vars)</span>
<span class="fc" id="L194">                             return</span>
                         }

                          // plan 0 end


<span class="fc" id="L200">             executionContext.src.asInstanceOf[AkkaMessageSource].address() ! IntentionErrorMessage(NoApplicablePlanMessage(),AkkaMessageSource(executionContext.agent.self))</span>

        }


                      def plan0(vars: VarMap)(implicit executionContext: ExecutionContext): Unit = {

<span class="fc" id="L207">                                          PrimitiveAction.execute(PrimitiveAction.Parameters(() =&gt; achieve(executionContext.src,StructTerm(&quot;greetings&quot;,Seq[GenericTerm]()))))</span>


                     }


      }




 }
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.6.202009150832</span></div></body></html>